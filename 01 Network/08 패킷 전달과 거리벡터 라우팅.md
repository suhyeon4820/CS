## 08. 패킷 전달과 거리벡터 라우팅

### 1. 패킷의 전달

#### 1) 패킷의 처리

- 인터넷은 **여러 네트워크의 연결**로 구성
  
  - 송신지에서 목적지까지의 **경로가 여럿** 존재
  
- 네트워크 계층은 **여러 네트워크를 통한 패킷 전달 문제를 해결**

  <img src = "Image\08\01.png" width = "500">

- **송신자의 네트워크 계층은 패킷을 생성**

  - 패킷이 너무 크다면 **단편화**가 발생
  - 목적지에 패킷을 전달하기 위해 **라우팅 테이블을 참조**

- 목적지의 네트워크 계층은 주소를 확인하여 자신에게 온 패킷인지 검사
  - IP패킷의 **헤더들을 검사**
  - **단편화**된 패킷을 받는다면, 단편들을 모아서 하나의 온전한 패킷으로 조립

  <img src = "Image\08\02.png" width = "500">

- 목스위치나 라우터와 같은 **중간장치들은 패킷을 라우팅**

  - 패킷이 도착하면 라우팅 테이블을 검사하고 보내야 하는 인터페이스(포트)를 확인

    <img src = "Image\08\03.png" width = "300">

- 패킷의 전달은 **직접 전달과 간접 전달로 나뉨**
  - 직접 전달(direct delivery) : 패킷의 **최종목적지가 전달자와 동일한 네트워크 상에 있을 경우**

  - 간접 전달(indirect delivery) : 패킷이 최종목적지에 전달될 때까지 **라우터에서 라우터로 전달**

    <img src = "Image\08\04.png" width = "500">

#### 2) 패킷의 전달

- 전달 방법

  - 이웃 노드 명시 (Nest-hop method)
    - 라우팅 테이블은 전체 경로상의 라우터를 명시하지 않고 **다음 라우터만을 명시**
    
    - A -> R1 -> R2 -> B 와 같이 모든 경로를 명시하는 것이 아니라 A는 R1만 명시
    
      <img src = "Image\08\05.png" width = "500">
  - 네트워크 주소 명시 (Network - specific method)
    - 동일한 네트워크에 연결된 컴퓨터들을 하나하나 모두 명시하는 것이 아니라 **목적지 네트워크 주소만 명시**
    
    - 192.168.10.20의 경우, 192.168.10.0으로 네트워크 주소만 라우팅 테이블에 등록
    
      <img src = "Image\08\06.png" width = "500">

- 
  
  - 호스트 주소 명시 (Host-specific method)
    - 라우팅 테이블에 **목적지 컴퓨터 주소를 직접 명시** 가능
    - 컴퓨터 주소를 라우팅 테이블에 갖는 것이 비효율적 그러나 **특별한 목적**이 있는 경우 포함 가능
    
    <img src = "Image\08\07.png" width = "400">
  - 디폴트 지정 (Default method)
    
    - **인터넷에 있는 모든 목적지를 지정할 수 없으므로** 지정된 목적지 이외의 모든 지역을 지정하는 라우팅 엔트리를 디폴트라고 함 (보통 네트워크 주소가 **0.0.0.0으로 표기**된다)
    
      <img src = "Image\08\08.png" width = "400">



### 2. 라우팅 프로토콜과 거리벡터 라우팅

#### 1) 라우팅 테이블과 라우팅 프로토콜

- 라우팅은 **패킷을 전달하기 위한 경로를 선택하는 과정**
- 라우팅 테이블은 정적 혹은 동적으로 구성
- **정적 라우팅 (static routing)** 테이블은 직접 입력
  
  - **자동으로 갱신될 수 없으며, 보통 호스트 컴퓨터에서 사용**
  - LAN에 접속된 호스트는 외부 인터넷으로 접속하는 출구가 하나로 되어있어 동적으로 구성할 필요성이 없음
- **동적 라우팅 (dynamic routing)** 테이블은 경로를 주기적으로 갱신 (대표적으로 RIP, OSPF, BGP가 존재)
- 라우팅 프로토콜에는 **유니캐스트와 멀티캐스트 두 개로 나누어짐**

  1. 유티캐스트 라우팅 프로토콜

  - 일반적인 라우팅 프로토콜로 **목적지가 하나임**

  - 경로를 선택하기 위해 **어떻게 라우팅 정보를 교환하여 라우팅 테이블을 구축할 것인가를 명시**

  - 송수신이 모두 하나의 시스템임

    <img src = "Image\08\09.png" width = "500">

  2. 멀티캐스트 라우팅 프로토콜

  - **목적지가 동일 그룹에 속한 여러 호스트**가 될 수 있음
- 자율 시스템 (AS : Autonomous System)
  - 하나의 라우팅 프로토콜이 전체 인터넷에서 통용되지 않음

  - **AS는 하나의 기관 내부를 나타낸 것으로 네트워크와 라우터의 집합**으로 구성
    
  - 라우팅 테이블의 정보를 주고받는 범위를 지정하여 지정한 범위 내에서 라우팅 테이블 정보를 주고받는 것
    
    <img src = "Image\08\10.png" width = "400">
    
    - 인터넷은 여러 기관의 네트워크로 구성, 각 기관은 AS로 볼 수 있음
    - http://bgp.potaroo.net/cidr/autnums.html
    - AS9686 SKKUNET-AS Sungkyunkwan University
    
  - 라우팅 프로토콜은 **내부 게이트웨이 프로토콜과 외부 게이트웨이 프로토콜로 구분**
    - 내부 게이트웨이 프로토콜 (interior gateway protocol, IGP) : **자율 시스템 내부**에 사용되는 라우팅 프로토콜 (IS-IS, OSPF, IGRP, EIGRP, RIP 등)
    - 외부 게이트웨이 프로토콜 (exterior gateway protocol, EGP) : **자율 시스템 간에 사용**되는 라우팅 프로토콜, BGP가 이에 속함
    
  - 각 AS는 **하나 또는 여러 개의 라우팅 프로토콜을 사용할 수 있음**

  - **AS간에는 반드시 하나의 라우팅 프로토콜만 사용**

    <img src = "Image\08\11.png" width = "400">

#### 2) 거리벡터라우팅 (Distance Vector Routing)

- **두 노드 사이의 최소 비용 경로는 최소거리를 갖는 경로**
  
  - 경로를 계산하기 위해서 **Bellman-Ford** 알고리즘을 사용
  
- 거리 벡터 라우팅을 사용하는 프로토콜로 **RIPv1/v2, IGRP(Interior Gateway Routing Protocol)** 존재
  
  - **BGP (Border Gateway Protocol)**도 거리 벡터 라우팅과 개념상 유사함
  
- 알고리즘의 동작
  - 각 라우터는 자신의 정보를 이웃 라우터와 공유
    - **전체 AS에 대한 정보를 공유**
    - **이웃 라우터하고만 공유**
    - **주기적으로 공유**
  
- Initialization

  <img src = "Image\08\12.png" width = "400">

  <img src = "Image\08\13.png" width = "400">







